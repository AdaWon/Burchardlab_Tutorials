<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Jennifer Liberto" />


<title>Jennifer’s R Tips and Tricks</title>

<script src="Rdict_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Rdict_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="Rdict_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Rdict_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Rdict_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="Rdict_files/navigation-1.1/tabsets.js"></script>
<link href="Rdict_files/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="Rdict_files/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Jennifer’s R Tips and Tricks</h1>
<h4 class="author"><em>Jennifer Liberto</em></h4>
<h4 class="date"><em>20 October, 2017</em></h4>

</div>

<div id="TOC">
<ul>
<li><a href="#contact">Contact</a></li>
<li><a href="#packages-and-libraries">Packages and Libraries</a></li>
<li><a href="#mode">Mode</a></li>
<li><a href="#for-loops">For Loops</a><ul>
<li><a href="#looping-through-a-vector">looping through a vector</a></li>
<li><a href="#looping-through-a-dataframe">looping through a dataframe</a></li>
<li><a href="#if-loops-inside-for-loops">if loops inside for loops</a></li>
<li><a href="#looping-though-a-list">looping though a list</a></li>
<li><a href="#advanced-loops">advanced Loops</a><ul>
<li><a href="#loop-output-is-a-vector">loop output is a vector</a></li>
<li><a href="#loop-output-is-set-of-new-variables-in-a-data-frame">loop output is set of new variables in a data frame</a></li>
<li><a href="#loop-output-is-a-data-frame">loop output is a data frame</a></li>
</ul></li>
</ul></li>
<li><a href="#by-function">By function</a></li>
<li><a href="#export-data">Export data</a></li>
<li><a href="#grep-and-regex">Grep and regex</a><ul>
<li><a href="#first-a-lesson-in-regular-expressions">first a lesson in regular expressions</a></li>
<li><a href="#grep-from-a-vector-or-a-variable-in-a-data-frame">grep from a vector or a variable in a data frame</a></li>
<li><a href="#grep-from-a-data-frame">grep from a data frame</a></li>
</ul></li>
<li><a href="#association-plots">Association plots</a><ul>
<li><a href="#the-data">the data</a></li>
<li><a href="#variables">variables</a></li>
<li><a href="#the-for-loop">the for loop</a></li>
<li><a href="#visualize-the-output-in-a-kable-table">visualize the output in a kable table</a></li>
<li><a href="#create-the-plot">create the plot</a></li>
<li><a href="#faceting">faceting</a><ul>
<li><a href="#common-issues-with-faceting">common issues with faceting</a></li>
</ul></li>
<li><a href="#muliplotting">Muliplotting</a></li>
</ul></li>
<li><a href="#pie-charts">Pie Charts</a></li>
<li><a href="#volcano-plots">volcano plots</a></li>
<li><a href="#prevelence-plots">Prevelence plots</a></li>
<li><a href="#exporting-a-plot">Exporting a plot</a></li>
</ul>
</div>

<div id="contact" class="section level1">
<h1>Contact</h1>
<p>For any questions/comments or if you want to play around with the data I used to try to re-create the plots and tables contact me at: <a href="mailto:jennifer.liberto@ucsf.edu">jennifer.liberto@ucsf.edu</a><br />
760-884-9469</p>
</div>
<div id="packages-and-libraries" class="section level1">
<h1>Packages and Libraries</h1>
<p>I like to use this as my <code>require(package)</code> becuase it will download, install and load them all in one quick loop. If the package already exists in my library it will skip the download and install and go straight to loading them.</p>
<pre class="r"><code># look for the following packages and if they don&#39;t exist, download them from cran and install
  for (package in c(&#39;package1&#39;,&#39;package2&#39;,&#39;package3&#39;)) {
    if (!require(package, character.only=T, quietly=T, warn.conflicts = F)) {
      install.packages(package, repos = &quot;http://cran.us.r-project.org&quot;)
      library(package, character.only=T, quietly=F, warn.conflicts = T)
    }
  }</code></pre>
</div>
<div id="mode" class="section level1">
<h1>Mode</h1>
<p>R doesn’t come with a mode function so this is the one I like to use</p>
<pre class="r"><code># mode funciton
  getmode = function(x){
    ta = table(x)
    tam = max(ta)
    if (all(ta == tam))
         mod = NA
    else
         if(is.numeric(x))
    mod = as.numeric(names(ta)[ta == tam])
    else
         mod = names(ta)[ta == tam]
    return(mod)
  }</code></pre>
</div>
<div id="for-loops" class="section level1">
<h1>For Loops</h1>
<div id="looping-through-a-vector" class="section level2">
<h2>looping through a vector</h2>
<pre class="r"><code># index by element
for (i in c(&quot;a&quot;,&quot;b&quot;,&quot;c&quot;)){
  somefunction(i)
}

# index by element position
for (i in 1:length(c(&quot;a&quot;,&quot;b&quot;,&quot;c&quot;))){
  somefunction(i)
}
</code></pre>
</div>
<div id="looping-through-a-dataframe" class="section level2">
<h2>looping through a dataframe</h2>
<pre class="r"><code>for (i in names(df)){
  somefunction(df[,i])
}</code></pre>
</div>
<div id="if-loops-inside-for-loops" class="section level2">
<h2>if loops inside for loops</h2>
<pre class="r"><code>for (i in names(df)){
  if (!(i %in% c(&quot;SubjectID&quot;, &quot;AFR&quot;, &quot;NAM&quot;))) {
    somefunction(df[,i])
  } else {
    someotherfunction(df[,i])
  }
}</code></pre>
</div>
<div id="looping-though-a-list" class="section level2">
<h2>looping though a list</h2>
<p>If you want to perform <code>somefunction</code> on variables common to more than one list, you can loop through the list and loop through the variable names.</p>
<pre class="r"><code>dfList &lt;- list(df1,df2)
dfNames &lt;- c(&quot;df1&quot;,&quot;df2&quot;)
varnames &lt;- c(&quot;var1&quot;,&quot;var2&quot;)

for(i in 1:length(dfList)){
    for (j in varnames) {
      print(paste(dfNames[i], j, sep = &quot; &quot;))
      somefunction(dfList[[i]][,j])
    }
}</code></pre>
</div>
<div id="advanced-loops" class="section level2">
<h2>advanced Loops</h2>
<div id="loop-output-is-a-vector" class="section level3">
<h3>loop output is a vector</h3>
<p>Say you want to remove ids from a dataframe who appear only once in the data frame. You would perform something like the following:<br />
1. split the data frame, <code>df</code>, into a list called <code>dati</code> based on a variable, <code>var</code><br />
2. define an empty vector, <code>newvector</code>, that will hold the output of your loop<br />
3. for each element in the list, if there are less than two rows place the name of that element into your vector<br />
4. append to the vector with each iteration of the loop</p>
<pre class="r"><code>dati &lt;- split(df, df$var)

newvector &lt;- c()
for (i in names(dati)){
  if (nrow(dati[[i]]) &lt; 2) {
    newvector &lt;- c(i,newvector)
  }
}</code></pre>
</div>
<div id="loop-output-is-set-of-new-variables-in-a-data-frame" class="section level3">
<h3>loop output is set of new variables in a data frame</h3>
<p>Say you want to create new variables in your data frame, <code>df</code>, based on the conditions of <code>i</code> and <code>j</code>. Somehting like this will output new variables: <code>df$var1.var3</code>, <code>df$var1.var4</code>, <code>df$var2.var3</code>, <code>df$var2.var4</code> in that order.</p>
<pre class="r"><code>vec1 &lt;- (&quot;var1&quot;,&quot;var2&quot;)
vec2 &lt;- (&quot;var3&quot;,&quot;var4&quot;)

for (i in vec1) {
  for (j in vec2) {
    newvar &lt;- paste(i,j,sep=&quot;.&quot;)
    df[[newvar]][condiiton of i and/or j] &lt;-&quot;0&quot;
    df[[newvar]][condiiton of i and/or j] &lt;-&quot;1&quot;
    df[[newvar]][condiiton of i and/or j] &lt;-&quot;2&quot;
    df[[newvar]][condiiton of i and/or j] &lt;-&quot;3&quot;
  }
}</code></pre>
</div>
<div id="loop-output-is-a-data-frame" class="section level3">
<h3>loop output is a data frame</h3>
<p>this will output a 3X2 data frame where the two columns are ave and std.ave and the rows are the mean and sd of a, b, and c.</p>
<pre class="r"><code>new.df &lt;- data.frame()
for (i in c(&quot;a&quot;,&quot;b&quot;,&quot;c&quot;)){
  ave &lt;- mean(df[,i])
  std.dev &lt;- sd(df[,i])
  new.df &lt;- rbind(new.df, cbind(ave,std.dev))
}</code></pre>
<p>We will see pretty much all this in action later in the <a href="#association-plots">Association plots</a> section of this tutorial.</p>
</div>
</div>
</div>
<div id="by-function" class="section level1">
<h1>By function</h1>
<p>by is a wrapper for the tapply function and basically splits a data frame into parts based on an index and applies a function. for example the folliwing will give you the number of subjects that are case vs control for each ethnic group</p>
<pre class="r"><code>by(mydata$has.asthma, mydata$group, table, useNA = &#39;ifany&#39;)</code></pre>
<pre><code>## mydata$group: African American
## 
##   0   1 
## 688 595 
## -------------------------------------------------------- 
## mydata$group: Mexican
## 
##   0   1 
## 843 537 
## -------------------------------------------------------- 
## mydata$group: Other Latino
## 
##   0   1 
## 380 272 
## -------------------------------------------------------- 
## mydata$group: Puerto Rican
## 
##    0    1 
## 1103  457</code></pre>
</div>
<div id="export-data" class="section level1">
<h1>Export data</h1>
<p>use <code>write.table</code> or <code>write.csv</code> to export data frames. <code>write.table</code> will output a <strong>tab delimited</strong> file while <code>write.csv</code> will output a <strong>comma seperated</strong> file. I always recommend using the options <code>row.names = FALSE</code> and <code>quote = FALSE</code>.</p>
</div>
<div id="grep-and-regex" class="section level1">
<h1>Grep and regex</h1>
<div id="first-a-lesson-in-regular-expressions" class="section level2">
<h2>first a lesson in regular expressions</h2>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
character
</th>
<th style="text-align:left;">
legend
</th>
<th style="text-align:left;">
example
</th>
<th style="text-align:left;">
sample.match
</th>
</tr>
</thead>
<tbody>
<tr grouplength="6">
<td colspan="4" style="background-color: #c1c1c1; color: #fff;">
<strong>Characters</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\d
</td>
<td style="text-align:left;">
one digit from 0 to 9
</td>
<td style="text-align:left;">
city_\d\d
</td>
<td style="text-align:left;">
city_06
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\w
</td>
<td style="text-align:left;">
word character
</td>
<td style="text-align:left;">
2\w\w\w-\w
</td>
<td style="text-align:left;">
2abc-a
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\s
</td>
<td style="text-align:left;">
space character
</td>
<td style="text-align:left;">
a\sb\sc
</td>
<td style="text-align:left;">
a b c
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\D
</td>
<td style="text-align:left;">
not a digit
</td>
<td style="text-align:left;">
\D\D\D\D
</td>
<td style="text-align:left;">
DaDa
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\W
</td>
<td style="text-align:left;">
not a word
</td>
<td style="text-align:left;">
\W\W\W\W\W
</td>
<td style="text-align:left;">
0+*)&amp;
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\S
</td>
<td style="text-align:left;">
not a whitespace
</td>
<td style="text-align:left;">
\S\S\S\S
</td>
<td style="text-align:left;">
Flip
</td>
</tr>
<tr grouplength="6">
<td colspan="4" style="background-color: #c1c1c1; color: #fff;">
<strong>Quantifiers</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
+
</td>
<td style="text-align:left;">
one or more
</td>
<td style="text-align:left;">
\d+-\w+
</td>
<td style="text-align:left;">
12345-one
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
{\d}
</td>
<td style="text-align:left;">
exactly \d times
</td>
<td style="text-align:left;">
\D{4}
</td>
<td style="text-align:left;">
DaDa
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
{\d,\d}
</td>
<td style="text-align:left;">
\d to \d times
</td>
<td style="text-align:left;">
\w{2,5}
</td>
<td style="text-align:left;">
apple
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
{,\d}
</td>
<td style="text-align:left;">
\d or more times
</td>
<td style="text-align:left;">
\d{,3}
</td>
<td style="text-align:left;">
123456
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
*
</td>
<td style="text-align:left;">
zero or more times
</td>
<td style="text-align:left;">
A*B*C
</td>
<td style="text-align:left;">
AACCC
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
?
</td>
<td style="text-align:left;">
once or none
</td>
<td style="text-align:left;">
A?BC
</td>
<td style="text-align:left;">
BC
</td>
</tr>
<tr grouplength="3">
<td colspan="4" style="background-color: #c1c1c1; color: #fff;">
<strong>More Characters</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
.
</td>
<td style="text-align:left;">
any character except a line break
</td>
<td style="text-align:left;">
a.b
</td>
<td style="text-align:left;">
abc
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\.
</td>
<td style="text-align:left;">
a period
</td>
<td style="text-align:left;">
a\.b
</td>
<td style="text-align:left;">
a.b
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\
</td>
<td style="text-align:left;">
escape a special character
</td>
<td style="text-align:left;">
\*
</td>
<td style="text-align:left;">
*
</td>
</tr>
<tr grouplength="4">
<td colspan="4" style="background-color: #c1c1c1; color: #fff;">
<strong>Logic</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
|
</td>
<td style="text-align:left;">
OR operand
</td>
<td style="text-align:left;">
2|3
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
( . . . )
</td>
<td style="text-align:left;">
capturing group
</td>
<td style="text-align:left;">
A(nt|pple)
</td>
<td style="text-align:left;">
Apple
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\1
</td>
<td style="text-align:left;">
contents of group 1
</td>
<td style="text-align:left;">
r(e)g\1x
</td>
<td style="text-align:left;">
regex
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\2
</td>
<td style="text-align:left;">
contents of group 2
</td>
<td style="text-align:left;">
(ab) + (cd) = \2 \+ \1
</td>
<td style="text-align:left;">
ab + cd  = cd + ab
</td>
</tr>
<tr grouplength="3">
<td colspan="4" style="background-color: #c1c1c1; color: #fff;">
<strong>White Space</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\t
</td>
<td style="text-align:left;">
tab
</td>
<td style="text-align:left;">
T\tab
</td>
<td style="text-align:left;">
T ab
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\n
</td>
<td style="text-align:left;">
newline
</td>
<td style="text-align:left;">
\n
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\r
</td>
<td style="text-align:left;">
carriage return
</td>
<td style="text-align:left;">
\r
</td>
<td style="text-align:left;">
</td>
</tr>
<tr grouplength="3">
<td colspan="4" style="background-color: #c1c1c1; color: #fff;">
<strong>Anchors and Boundaries</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
^
</td>
<td style="text-align:left;">
beginning of string or line
</td>
<td style="text-align:left;">
^abc
</td>
<td style="text-align:left;">
a
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
$
</td>
<td style="text-align:left;">
end of string or line
</td>
<td style="text-align:left;">
this is the end$
</td>
<td style="text-align:left;">
end
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentlevel="1">
\b
</td>
<td style="text-align:left;">
word boundry
</td>
<td style="text-align:left;">
I\bbaked\pies
</td>
<td style="text-align:left;">
I baked pies
</td>
</tr>
<tr>
<td style="text-align:left;">
\B
</td>
<td style="text-align:left;">
not a word boundary
</td>
<td style="text-align:left;">
d.*\Bies\B.*
</td>
<td style="text-align:left;">
doggies
</td>
</tr>
<tr grouplength="3">
<td colspan="4" style="background-color: #c1c1c1; color: #fff;">
<strong>Character Classes</strong>
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentLevel="1">
[ . . . ]
</td>
<td style="text-align:left;">
one of the characters in the brackets
</td>
<td style="text-align:left;">
[A-Fa-z0-9]+
</td>
<td style="text-align:left;">
Dad03
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentLevel="1">
[a-z]
</td>
<td style="text-align:left;">
range of characters between a and z
</td>
<td style="text-align:left;">
[A-D]+
</td>
<td style="text-align:left;">
CDB
</td>
</tr>
<tr>
<td style="text-align:left; padding-left: 2em;" indentLevel="1">
[^x]
</td>
<td style="text-align:left;">
one character that is not x
</td>
<td style="text-align:left;">
[^a-z]{3}
</td>
<td style="text-align:left;">
A1!
</td>
</tr>
</tbody>
</table>
</div>
<div id="grep-from-a-vector-or-a-variable-in-a-data-frame" class="section level2">
<h2>grep from a vector or a variable in a data frame</h2>
<p>grep uses regular expressions (regex) to capture data below will be a few examples of what grep can do</p>
<pre class="r"><code>vec &lt;- c(&quot;english springer spaniel&quot;,&quot;akita&quot;,&quot;shiba inu&quot;,&quot;golden retriever&quot;,&quot;lab&quot;,&quot;cocker spaniel&quot;,&quot;bermese mountain&quot;,&quot;german shorhair pointer&quot;,&quot; german shepard&quot;,&quot;cavalier king charles spaniel&quot;,&quot;australian sheep dog&quot;,&quot;jack russel&quot;,&quot;pug&quot;)

# grab all the spaniels from the list and notice the differences in the output from each of these commands
grep(&quot;spaniel&quot;, vec)</code></pre>
<pre><code>## [1]  1  6 10</code></pre>
<pre class="r"><code>regmatches(vec, regexpr(&quot;spaniel&quot;, vec)) </code></pre>
<pre><code>## [1] &quot;spaniel&quot; &quot;spaniel&quot; &quot;spaniel&quot;</code></pre>
<pre class="r"><code>regmatches(vec, regexpr(&quot;([a-z]+\ ?)+spaniel&quot;, vec))</code></pre>
<pre><code>## [1] &quot;english springer spaniel&quot;      &quot;cocker spaniel&quot;               
## [3] &quot;cavalier king charles spaniel&quot;</code></pre>
<pre class="r"><code># now grab the dogs that have no spaces in their name.  Notice the differences in the outputs from each of these commands
regmatches(vec, regexpr(&quot;[a-z]+&quot;, vec))</code></pre>
<pre><code>##  [1] &quot;english&quot;    &quot;akita&quot;      &quot;shiba&quot;      &quot;golden&quot;     &quot;lab&quot;       
##  [6] &quot;cocker&quot;     &quot;bermese&quot;    &quot;german&quot;     &quot;german&quot;     &quot;cavalier&quot;  
## [11] &quot;australian&quot; &quot;jack&quot;       &quot;pug&quot;</code></pre>
<pre class="r"><code>regmatches(vec, regexpr(&quot;^[a-z]+$&quot;, vec))</code></pre>
<pre><code>## [1] &quot;akita&quot; &quot;lab&quot;   &quot;pug&quot;</code></pre>
</div>
<div id="grep-from-a-data-frame" class="section level2">
<h2>grep from a data frame</h2>
<pre class="r"><code># say you want to pull out all the variables that end in _before2yr into a new dataframe
before2yr.df &lt;- sapply(names(mydata), grepl, pattern = &quot;_before2yr&quot;)

# how about finding all the variables that have data that is either 0, 1, 2, 8, 88, or NA and you want to change all the 8&#39;s and 88&#39;s to NA
for (i in names(mydata)){
            if (all(mydata[, i] %in% c(0,1,2,8,88,NA)) == TRUE){
              change.vars &lt;- i
              mydata[, change.vars] &lt;- gsub(&quot;^8$&quot;,NA,mydata[, change.vars])
              mydata[, change.vars] &lt;- gsub(&quot;^88$&quot;,NA,mydata[, change.vars])
            }
          }
  
# how about removing all the leading and trailing whitespace in the dataframe
mydata.new &lt;- as.data.frame(apply(mydata,2,function(x)gsub(&#39;^\\s+|\\s+$&#39;,&#39;&#39;,x)))

# how about replacing a range of values with it&#39;s average
# first you will need to find all the variables that have ranges in their data
# then you need to substiture the range for the average using the function gsubfn
# note that gsubfn does not like NA so what I did is transform NA to R4nD0m then transformed it back

for (i in names(mydata)){
            if (any(grepl(&quot;([0-9]+-[0-9]+))&quot;, mydata[, i]) == TRUE)){
              change.vars &lt;- i
              mydata[, change.vars] &lt;- as.character(mydata[, change.vars])
              mydata[, change.vars][is.na(mydata[, change.vars])] &lt;- &quot;R4nD0m&quot;
              mydata[, change.vars] &lt;- gsubfn(&quot;([0-9]+)-([0-9]+)&quot;,~ round((as.numeric(x) + as.numeric(y))/2,digits = 1),mydata[, change.vars])
              mydata[, change.vars][mydata[, change.vars] == &quot;R4nD0m&quot;] &lt;- NA
            }
          }</code></pre>
<p>Now you should have a pretty good understanding of for loops and regular expressions so lets see that in action.</p>
</div>
</div>
<div id="association-plots" class="section level1">
<h1>Association plots</h1>
<div id="the-data" class="section level2">
<h2>the data</h2>
<p>Lets have a look at the type of data we will be using. For this exercise, I cleaned, combineded, and subset SAGE II and GALA II.</p>
<pre class="r"><code>  str(mydata)</code></pre>
<pre><code>## &#39;data.frame&#39;:    4875 obs. of  19 variables:
##  $ SubjectID                  : Factor w/ 6396 levels &quot;AV1001&quot;,&quot;AV1002&quot;,..: 36 37 38 43 46 49 50 51 53 56 ...
##  $ Male                       : Factor w/ 2 levels &quot;Female&quot;,&quot;Male&quot;: 1 2 2 2 1 1 1 1 1 1 ...
##  $ group                      : Factor w/ 4 levels &quot;African American&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ area                       : Factor w/ 5 levels &quot;IL&quot;,&quot;NY&quot;,&quot;PR&quot;,..: 4 4 4 4 4 4 4 4 4 4 ...
##  $ medu                       : int  1 1 1 0 1 1 1 0 0 1 ...
##  $ SESinsur                   : int  2 2 2 2 2 2 2 2 2 2 ...
##  $ underweight                : int  0 0 NA 0 NA 0 0 0 0 0 ...
##  $ bf                         : int  0 0 NA 0 1 1 1 0 0 1 ...
##  $ preg_smoke                 : int  0 0 0 1 0 0 0 0 1 0 ...
##  $ onset                      : num  13 2 4 10.5 6 10 5 2 7 10 ...
##  $ sibs_old                   : int  0 2 1 2 1 0 0 0 0 0 ...
##  $ AFR                        : num  0.93 0.836 0.815 0.84 0.858 ...
##  $ NAM                        : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ chest_ill_before2yr        : int  0 0 0 0 0 0 1 1 0 1 ...
##  $ cold_before2yr             : int  0 0 0 0 0 0 1 1 0 0 ...
##  $ pneumonia_before2yr        : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ bronchitis_before2yr       : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ bronchiolitis_RSV_before2yr: int  0 0 0 0 0 0 0 0 0 0 ...
##  $ has.asthma                 : int  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div id="variables" class="section level2">
<h2>variables</h2>
<p>I like to define variables that will be used in my models before hand so that the code is not too bogged down with text</p>
<pre class="r"><code># define the elements of your logistic model
  illness = c(&quot;chest_ill_before2yr&quot;, &quot;cold_before2yr&quot;, &quot;pneumonia_before2yr&quot;, &quot;bronchitis_before2yr&quot;, &quot;bronchiolitis_RSV_before2yr&quot;)
  illness.abrv = c(&quot;chest_ill&quot;, &quot;cold&quot;, &quot;pneumonia&quot;, &quot;bronc&quot;, &quot;rsv&quot;)
  outcome &lt;- &quot;has.asthma ~&quot;</code></pre>
</div>
<div id="the-for-loop" class="section level2">
<h2>the for loop</h2>
<pre class="r"><code># subset
  df.AA &lt;- mydata[which(mydata$group == &quot;African American&quot;),]
  df.PR &lt;- mydata[which(mydata$group == &quot;Puerto Rican&quot;),]
  df.MX &lt;- mydata[which(mydata$group == &quot;Mexican&quot;),]

# turn into a list
  dfList &lt;- list(df.AA, df.PR, df.MX)

# for each illness in each dataframe run a logistic model and and compile the data into a new data frame
final.df &lt;- data.frame()
for (i in 1:length(dfList)){
  temp.df &lt;- data.frame()
  for (j in illness) {
  if (all(dfList[[i]]$group == &quot;African American&quot;) == TRUE) {
    form &lt;- formula(paste(outcome,j,&quot;+ bf + underweight + preg_smoke + sibs_old + Male + medu + SESinsur&quot;))
  } else {
    form &lt;- formula(paste(outcome,j,&quot;+ bf + underweight + preg_smoke + sibs_old + Male + medu + SESinsur + area&quot;))
  } 
   mod &lt;- glm(form, data = dfList[[i]], family = &#39;binomial&#39;)
   temp.df &lt;- rbind(temp.df,
                   cbind(
                    OR = round(exp(coef(mod)[-1]), digits = 3),
                    LL = round(exp(confint(mod)[-1,1]), digits = 3),
                    UL = round(exp(confint(mod)[-1,2]), digits = 3),
                    N = nobs(mod), 
                    p.value = summary(mod)$coef[-1, 4]
                  )[1,]
                )
  }
  names(temp.df) &lt;- c(&#39;OR&#39;, &#39;LL&#39;, &#39;UL&#39;, &#39;N&#39;, &#39;p.value&#39;)
  temp.df$cond &lt;- illness.abrv
  if (all(dfList[[i]]$group == &quot;African American&quot;) == TRUE) {
    temp.df$group &lt;- &quot;African American&quot;
  } else if (all(dfList[[i]]$group == &quot;Puerto Rican&quot;) == TRUE) {
    temp.df$group &lt;- &quot;Puerto Rican&quot;
  } else {
    temp.df$group &lt;- &quot;Mexican&quot;
  }
  final.df &lt;- rbind(final.df,temp.df)
}</code></pre>
</div>
<div id="visualize-the-output-in-a-kable-table" class="section level2">
<h2>visualize the output in a kable table</h2>
<p>in markdown kable creates some quite beautiful and customizable tables</p>
<pre class="r"><code># view the final data frame that we made
kable.df &lt;- final.df[,-c(7)]
  kable(kable.df, &quot;html&quot;, align = &quot;c&quot;, row.names = FALSE) %&gt;%
    kable_styling(bootstrap_options =&quot;striped&quot;,full_width = F) %&gt;%
    group_rows(&quot;African American&quot;, 1, 5, label_row_css = &quot;background-color: #c1c1c1; color: #fff;&quot;)  %&gt;%
    group_rows(&quot;Puerto Rican&quot;, 6, 10, label_row_css = &quot;background-color: #c1c1c1; color: #fff;&quot;)  %&gt;%
    group_rows(&quot;Mexican&quot;, 11, 15, label_row_css = &quot;background-color: #c1c1c1; color: #fff;&quot;)</code></pre>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
OR
</th>
<th style="text-align:center;">
LL
</th>
<th style="text-align:center;">
UL
</th>
<th style="text-align:center;">
N
</th>
<th style="text-align:center;">
p.value
</th>
<th style="text-align:center;">
cond
</th>
</tr>
</thead>
<tbody>
<tr grouplength="5">
<td colspan="6" style="background-color: #c1c1c1; color: #fff;">
<strong>African American</strong>
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentlevel="1">
4.637
</td>
<td style="text-align:center;">
3.053
</td>
<td style="text-align:center;">
7.217
</td>
<td style="text-align:center;">
827
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
chest_ill
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentlevel="1">
4.653
</td>
<td style="text-align:center;">
2.681
</td>
<td style="text-align:center;">
8.534
</td>
<td style="text-align:center;">
840
</td>
<td style="text-align:center;">
0.0000002
</td>
<td style="text-align:center;">
cold
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentlevel="1">
1.788
</td>
<td style="text-align:center;">
0.897
</td>
<td style="text-align:center;">
3.677
</td>
<td style="text-align:center;">
840
</td>
<td style="text-align:center;">
0.1033120
</td>
<td style="text-align:center;">
pneumonia
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentlevel="1">
2.626
</td>
<td style="text-align:center;">
1.035
</td>
<td style="text-align:center;">
7.543
</td>
<td style="text-align:center;">
840
</td>
<td style="text-align:center;">
0.0523905
</td>
<td style="text-align:center;">
bronc
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentlevel="1">
3.306
</td>
<td style="text-align:center;">
0.721
</td>
<td style="text-align:center;">
23.324
</td>
<td style="text-align:center;">
840
</td>
<td style="text-align:center;">
0.1550318
</td>
<td style="text-align:center;">
rsv
</td>
</tr>
<tr grouplength="5">
<td colspan="6" style="background-color: #c1c1c1; color: #fff;">
<strong>Puerto Rican</strong>
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentlevel="1">
8.988
</td>
<td style="text-align:center;">
6.225
</td>
<td style="text-align:center;">
13.117
</td>
<td style="text-align:center;">
1045
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
chest_ill
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentlevel="1">
5.168
</td>
<td style="text-align:center;">
3.277
</td>
<td style="text-align:center;">
8.246
</td>
<td style="text-align:center;">
1046
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
cold
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentlevel="1">
6.786
</td>
<td style="text-align:center;">
2.450
</td>
<td style="text-align:center;">
21.764
</td>
<td style="text-align:center;">
1046
</td>
<td style="text-align:center;">
0.0004405
</td>
<td style="text-align:center;">
pneumonia
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentlevel="1">
12.966
</td>
<td style="text-align:center;">
6.507
</td>
<td style="text-align:center;">
28.217
</td>
<td style="text-align:center;">
1046
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
bronc
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentlevel="1">
7.931
</td>
<td style="text-align:center;">
4.117
</td>
<td style="text-align:center;">
16.125
</td>
<td style="text-align:center;">
1046
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
rsv
</td>
</tr>
<tr grouplength="5">
<td colspan="6" style="background-color: #c1c1c1; color: #fff;">
<strong>Mexican</strong>
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentLevel="1">
2.631
</td>
<td style="text-align:center;">
1.779
</td>
<td style="text-align:center;">
3.927
</td>
<td style="text-align:center;">
873
</td>
<td style="text-align:center;">
0.0000016
</td>
<td style="text-align:center;">
chest_ill
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentLevel="1">
2.225
</td>
<td style="text-align:center;">
1.144
</td>
<td style="text-align:center;">
4.403
</td>
<td style="text-align:center;">
861
</td>
<td style="text-align:center;">
0.0193849
</td>
<td style="text-align:center;">
cold
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentLevel="1">
1.999
</td>
<td style="text-align:center;">
0.917
</td>
<td style="text-align:center;">
4.557
</td>
<td style="text-align:center;">
861
</td>
<td style="text-align:center;">
0.0874304
</td>
<td style="text-align:center;">
pneumonia
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentLevel="1">
4.462
</td>
<td style="text-align:center;">
2.202
</td>
<td style="text-align:center;">
9.833
</td>
<td style="text-align:center;">
862
</td>
<td style="text-align:center;">
0.0000759
</td>
<td style="text-align:center;">
bronc
</td>
</tr>
<tr>
<td style="text-align:center; padding-left: 2em;" indentLevel="1">
2.021
</td>
<td style="text-align:center;">
0.553
</td>
<td style="text-align:center;">
8.202
</td>
<td style="text-align:center;">
861
</td>
<td style="text-align:center;">
0.2920152
</td>
<td style="text-align:center;">
rsv
</td>
</tr>
</tbody>
</table>
</div>
<div id="create-the-plot" class="section level2">
<h2>create the plot</h2>
<pre class="r"><code># convert to factors for aesthetics
  final.df$cond &lt;- factor(final.df$cond,levels=unique(final.df$cond))
  final.df$group &lt;- factor(final.df$group,levels=unique(final.df$group))</code></pre>
<p>convert <code>cond</code> and <code>group</code> to factors so that ggplot will plot the conditions and the group in the order they appear in the data frame</p>
<pre class="r"><code># so points in each group don&#39;t overlap with each other
dodge &lt;- position_dodge(width=0.6)

# the plot
ggplot(final.df, aes(color = group)) + 
  geom_pointrange(aes(x = cond, y = as.numeric(as.character(OR)), ymin = as.numeric(as.character(LL)), ymax = as.numeric(as.character(UL))), 
                  position = dodge) +
  labs(x = &#39;&#39;, y=&#39;Odds Ratio&#39;) + 
  scale_y_log10() + 
  theme_classic() +
  geom_hline(aes(yintercept = 1), col = &#39;gray50&#39;, lty = 2) +
  theme(legend.position = &quot;bottom&quot;, text = element_text(size=14, face=&#39;bold&#39;), plot.title = element_text(hjust = 0.5)) +
  guides(color = guide_legend(title = &quot;&quot;,override.aes = list(linetype = 0))) +
  scale_color_manual(values = c(&quot;grey30&quot;,&quot;orange&quot;,&quot;springgreen4&quot;)) +
  ggtitle(&quot;Example of an Odds Ratio Plot&quot;)</code></pre>
<p><img src="Rdict_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="faceting" class="section level2">
<h2>faceting</h2>
<p>Faceting allows you to seperate your data and plot everything on the same scale. It is useful if you have used up all the different aesthetics (<code>color</code>, <code>alpha</code>, <code>size</code>, <code>shape</code>, <code>fill</code>, <code>linetype</code>, <code>group</code>). For this example, I show<br />
1. that you can facet along the x or y axis<br />
2. that you can facet by two groups<br />
3. how to fix common issues that come with faceting</p>
<pre class="r"><code># set your base graph
p &lt;- ggplot(final.df, aes(color = group)) + 
  geom_pointrange(aes(x = cond, y = as.numeric(as.character(OR)), ymin = as.numeric(as.character(LL)), ymax = as.numeric(as.character(UL))), 
                  position = dodge) +
  labs(x = &#39;&#39;, y=&#39;Odds Ratio&#39;) + 
  scale_y_log10() + 
  theme_classic() +
  geom_hline(aes(yintercept = 1), col = &#39;gray50&#39;, lty = 2) +
  guides(color = guide_legend(title = &quot;&quot;,override.aes = list(linetype = 0))) +
  theme(legend.position = &quot;bottom&quot;, text = element_text(size=14, face=&#39;bold&#39;)) +
  scale_color_manual(values = c(&quot;grey30&quot;,&quot;orange&quot;,&quot;springgreen4&quot;))

# facet by group on the y axis
p + facet_grid(group ~ .)</code></pre>
<p><img src="Rdict_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code># facet by group on the x axis
p+ facet_grid(. ~ group)</code></pre>
<p><img src="Rdict_files/figure-html/unnamed-chunk-12-2.png" width="672" /></p>
<div id="common-issues-with-faceting" class="section level3">
<h3>common issues with faceting</h3>
<ol style="list-style-type: decimal">
<li>facet labels dont fit<br />
</li>
<li>axis ticks overlap each other<br />
To fix (1) can be challenging so I like to create new columns in my dataset with shortened label names and use those to build the plot. To fix (2) is as easy as adjsuting the the angle of the text using the <code>theme</code> function in ggplot</li>
</ol>
<pre class="r"><code># facet lables aren&#39;t easy to fix so lets create shortened labels that are still informative
final.df$group.abrv &lt;- NA
final.df$group.abrv &lt;- ifelse(final.df$group == &quot;African American&quot;, &quot;AFR&quot;, final.df$group.abrv)
final.df$group.abrv &lt;- ifelse(final.df$group == &quot;Puerto Rican&quot;, &quot;PUR&quot;, final.df$group.abrv)
final.df$group.abrv &lt;- ifelse(final.df$group == &quot;Mexican&quot;, &quot;MEX&quot;, final.df$group.abrv)

ggplot(final.df, aes(color = group.abrv)) + 
  geom_pointrange(aes(x = cond, y = as.numeric(as.character(OR)), ymin = as.numeric(as.character(LL)), ymax = as.numeric(as.character(UL))), 
                  position = dodge) +
  labs(x = &#39;&#39;, y=&#39;Odds Ratio&#39;) + 
  scale_y_log10() + 
  theme_classic() +
  geom_hline(aes(yintercept = 1), col = &#39;gray50&#39;, lty = 2) +
  guides(color = guide_legend(title = &quot;&quot;,override.aes = list(linetype = 0))) +
  theme(legend.position = &quot;bottom&quot;, text = element_text(size=14, face=&#39;bold&#39;)) +
  scale_color_manual(values = c(&quot;grey30&quot;,&quot;orange&quot;,&quot;springgreen4&quot;)) +
  facet_grid(group.abrv ~ cond) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))</code></pre>
<p><img src="Rdict_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
</div>
<div id="muliplotting" class="section level2">
<h2>Muliplotting</h2>
<p>Multiplotting is a great way to place more than one plot in a graphing area. You can have as many as you like, but 4 is the recommended number.</p>
<pre class="r"><code># multiplot function
multiplot &lt;- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)

  # Make a list from the ... arguments and plotlist
  plots &lt;- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use &#39;cols&#39; to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout &lt;- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx &lt;- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}</code></pre>
<p>Lets put our multiplot function to the test</p>
<pre class="r"><code>a &lt;- rnorm(3000, mean = 1, sd = 0.5)
b &lt;- rnorm(3000, mean = 0, sd = 1)

ex1 &lt;- data.frame(a,b)

p &lt;- ggplot(ex1) 
p1 &lt;- p + geom_point(aes(x = a, y = b))
p2 &lt;- p + geom_histogram(aes(a), fill = &quot;grey30&quot;, binwidth = 0.3)
p3 &lt;- p + geom_histogram(aes(a), fill = &quot;grey30&quot;,  binwidth = 0.3) + geom_histogram(aes(b), alpha = 0.75, fill = &quot;springgreen4&quot;,  binwidth = 0.3)
p4 &lt;- p + geom_density(aes(a), fill = &quot;grey30&quot;) + geom_density(aes(b), alpha = 0.75, fill = &quot;springgreen4&quot;)

multiplot(p1,p2,p3,p4, cols = 2)</code></pre>
<p><img src="Rdict_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
</div>
<div id="pie-charts" class="section level1">
<h1>Pie Charts</h1>
<p>Pie charts are just like bar plots except on polar corrdinates</p>
<pre class="r"><code>data.check &lt;- mydata
data.check$Male &lt;- reorder(data.check$Male, X = data.check$Male, FUN = function(x) -length(x))
# the at calculation is finding the centers of the wedges. (It&#39;s easier to think of them as the centers of bars in a stacked bar plot
at &lt;- as.numeric(cumsum(sort(table(data.check$Male)))-0.5*sort(table(data.check$Male)))
label=paste0(round(sort(table(data.check$Male))/sum(table(data.check$Male)),2) * 100,&quot;%&quot;)


ggplot(data.check,aes(x=&quot;&quot;, fill = Male)) +
  geom_bar(width = 1) +
  coord_polar(theta=&quot;y&quot;) +
  annotate(geom = &quot;text&quot;, y = at, x = 1, label = label, color  = &quot;white&quot;, size=10) +
  theme_void() +
  theme(text = element_text(size=14, face=&#39;bold&#39;), plot.title = element_text(hjust = 0.5)) +
  scale_fill_manual(values = c(&quot;grey30&quot;,&quot;springgreen4&quot;)) +
  ggtitle(&quot;Example of a Pie Chart&quot;)</code></pre>
<p><img src="Rdict_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="volcano-plots" class="section level1">
<h1>volcano plots</h1>
<pre class="r"><code># this example will use methylation data 
  cold &lt;- read.csv(&quot;~/Dropbox/Viral_meth_SO/cold_illness_methylation.csv&quot;, header = T, fill = T, na.strings = &quot;&quot;)

# use a regular expression to reduce the gene names from gene;gene;gene;gene etc. to just gene\
  n &lt;- nrow(cold)
  bonf &lt;- 0.05/n
  sugg &lt;- 1/n
  cold$padj &lt;- cold$pvalue/sugg
  cold$plot.colors &lt;- ifelse(cold$padj &lt;= 1, &quot;orange&quot;,&quot;black&quot;)
  cold$plot.colors &lt;- ifelse(cold$padj &lt;= 0.05, &quot;red&quot;,cold$plot.colors)
  cold$simple.gene.name &lt;- gsub(&quot;([A-Z0-9]+)((;[A-Z0-9]+)+)?&quot;,&quot;\\1&quot;, as.character(cold$UCSC_REFGENE_NAME))
  cold$gene_name &lt;- ifelse(cold$padj &lt;= 1, as.character(cold$simple.gene.name),NA) # only significant genes get gene_name so as to not overwhelm the volcano plot

  # check our the data we are using to create the plot
  str(cold) </code></pre>
<pre><code>FALSE &#39;data.frame&#39;: 321503 obs. of  13 variables:
FALSE  $ X                          : Factor w/ 321503 levels &quot;cg00000029&quot;,&quot;cg00000236&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
FALSE  $ coef                       : num  -2.62e-03 -2.36e-03 -6.66e-03 -1.62e-03 -9.35e-05 ...
FALSE  $ se                         : num  0.00503 0.00319 0.00611 0.00473 0.00343 ...
FALSE  $ pvalue                     : num  0.602 0.459 0.276 0.733 0.978 ...
FALSE  $ UCSC_REFGENE_NAME          : Factor w/ 36604 levels &quot;A1BG&quot;,&quot;A1CF;A1CF;A1CF&quot;,..: 26412 34499 412 28538 NA 21614 18634 33480 18163 7160 ...
FALSE  $ UCSC_REFGENE_GROUP         : Factor w/ 3461 levels &quot;1stExon&quot;,&quot;1stExon;1stExon&quot;,..: 2458 626 628 2458 NA 3426 1689 1933 1689 1156 ...
FALSE  $ RELATION_TO_UCSC_CPG_ISLAND: Factor w/ 5 levels &quot;Island&quot;,&quot;N_Shelf&quot;,..: 3 NA 3 5 3 1 1 5 4 1 ...
FALSE  $ CHR                        : int  16 8 14 8 1 15 9 19 6 3 ...
FALSE  $ MAPINFO                    : int  53468112 42263294 69341139 41167802 230560793 23034447 139997924 54695678 25282779 128902377 ...
FALSE  $ padj                       : num  193626 147685 88583 235544 314525 ...
FALSE  $ plot.colors                : chr  &quot;black&quot; &quot;black&quot; &quot;black&quot; &quot;black&quot; ...
FALSE  $ simple.gene.name           : chr  &quot;RBL2&quot; &quot;VDAC3&quot; &quot;ACTN1&quot; &quot;SFRP1&quot; ...
FALSE  $ gene_name                  : chr  NA NA NA NA ...</code></pre>
<pre class="r"><code># create an awesome volcano plot
# to avoid overlapping gene names, use geom_label_repeal

  
  ggplot() +
    geom_point(data = cold, 
               aes(x=coef, y = -log10(pvalue)), 
               colour = cold$plot.colors) +
    # bonferroni significance threshold
    geom_hline(aes(yintercept=-log(bonf/1, 10)), 
               colour=&quot;red&quot;, 
               linetype=&quot;dashed&quot;) +
    # suggestive significance threshold line
    geom_hline(aes(yintercept=-log(bonf/0.05, 10)),  
               colour=&quot;orange&quot;,  
               linetype=&quot;dashed&quot;) +
    # non overlapping gene labels
    geom_label_repel(aes(x=cold$coef, y = -log10(cold$pvalue), label = cold$gene_name),
                     fontface = &#39;bold&#39;,
                     fill = &quot;springgreen4&quot;,
                     color = &quot;white&quot;,
                     box.padding = 0.35, 
                     point.padding = 0.5, 
                     segment.color = &#39;grey30&#39;) +
    theme(legend.position = &quot;none&quot;, text = element_text(size=14, face=&#39;bold&#39;))</code></pre>
<p><img src="Rdict_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
<div id="prevelence-plots" class="section level1">
<h1>Prevelence plots</h1>
<pre class="r"><code>prev.final &lt;- data.frame()
for (i in illness) {
  tab &lt;- CrossTable(x = mydata$group, y = mydata[,i], format = &#39;SAS&#39;, prop.r = T, prop.c = F, prop.t = F, prop.chisq = F, digits = 1)
  prev.tab &lt;- data.frame()
  for (j in tab$prop.row[,2]) {
    prev.tab&lt;-rbind(prev.tab,cbind(i,round(j,digits = 3)))
  }
  names(prev.tab) = c(&#39;cond&#39;, &#39;prev&#39;)
  prev.tab$group &lt;- c(&#39;African American&#39;,&#39;Mexican&#39;,&#39;Other Latino&#39;,&#39;Puerto Rican&#39;)
  prev.final &lt;- rbind(prev.final, prev.tab)
}

tab.sort &lt;- prev.final[order(prev.final$group),]
tab.sort2 &lt;- tab.sort[c(1:5,11:20,6:10),]
prev.tab.clean &lt;- subset(tab.sort2, group != &quot;Other Latino&quot;)
# make axis labels legible by shortening them
prev.tab.clean$cond.abv &lt;- NA
prev.tab.clean$cond.abv &lt;- ifelse(prev.tab.clean$cond == &quot;chest_ill_before2yr&quot;, &quot;chest_ill&quot;, prev.tab.clean$cond.abv)
prev.tab.clean$cond.abv &lt;- ifelse(prev.tab.clean$cond == &quot;cold_before2yr&quot;, &quot;cold&quot;, prev.tab.clean$cond.abv)
prev.tab.clean$cond.abv &lt;- ifelse(prev.tab.clean$cond == &quot;pneumonia_before2yr&quot;, &quot;pneumonia&quot;, prev.tab.clean$cond.abv)
prev.tab.clean$cond.abv &lt;- ifelse(prev.tab.clean$cond == &quot;bronchitis_before2yr&quot;, &quot;bronc&quot;, prev.tab.clean$cond.abv)
prev.tab.clean$cond.abv &lt;- ifelse(prev.tab.clean$cond == &quot;bronchiolitis_RSV_before2yr&quot;, &quot;rsv&quot;, prev.tab.clean$cond.abv)

  
prev.tab.clean$cond.abv &lt;- factor(prev.tab.clean$cond.abv,levels=unique(prev.tab.clean$cond.abv))
prev.tab.clean$group &lt;- factor(prev.tab.clean$group,levels=unique(prev.tab.clean$group))

# plot
ggplot(prev.tab.clean, aes(x=cond.abv, y=as.numeric(as.character(prev)), fill=group)) + 
  geom_bar(stat=&#39;identity&#39;, position = position_dodge(width=0.91)) + 
  labs(x = &#39;&#39;, y=&#39;Prevalence&#39;) + 
  scale_y_continuous(labels=percent) + 
  ggtitle(&quot;Prevelence Of Early Childhood Respiratory Illness&quot;) + 
  theme_classic() + 
  theme(legend.position=&quot;bottom&quot;, text = element_text(size=15, face=&#39;bold&#39;)) +
  scale_fill_manual(values = c(&quot;grey30&quot;, &quot;springgreen4&quot;, &quot;orange&quot;))</code></pre>
<p><img src="Rdict_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="exporting-a-plot" class="section level1">
<h1>Exporting a plot</h1>
<pre class="r"><code>pdf(&#39;~/file/path/to/export.pdf&#39;, width = 20, height = 8)
### your plot ###
dev.off()</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
